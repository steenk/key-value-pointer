/* key-value-pointer v0.2.2, (c) 2015 Steen Klingberg. License: MIT */
!function(e,t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module?module.exports=t():e.keyValuePointer=t()}(this,function(){function e(e,t){var n,o,r=!1;if("string"==typeof e&&(e=JSON.parse(e)),"object"==typeof e){if("string"==typeof t)n=t.split("/");else{if(!Array.isArray(t))return;n=t}return n.forEach(function(t){r||(t=t.replace("~1","/").replace("~0","~"),""===t?o=e:"undefined"==typeof o[t]?(r=!0,o=void 0):o=o[t])}),o}}return function(t){function n(e,t,i){var c,l,f,u,p=[];for(l=0;l<e.length;l++){u=e[l];for(c in u){var s=i+"/"+l;if(f=t.call(o,{key:c,value:u[c],pointer:r[s]+"/"+c}))return u[c];"object"==typeof u[c]&&null!==u[c]&&(r[i+1+"/"+p.length]=r[s]+"/"+c,p.push(u[c]))}}return p.length>0?n(p,t,i+1):void 0}var o=function(){},r={"0/0":""};return"string"==typeof t&&(t=JSON.parse(t)),"object"==typeof t&&null!==t?o.collection=[t]:console.error(new Error("Only objects are allowed.")),o.query=function(e){return n(this.collection,e,0)},o.select=function(t){return e(this.collection[0],t)},o.replace=function(t,n){var o=t.split("/"),r=o.pop();e(this.collection[0],o)[r]=n},o.remove=function(t){var n=t.split("/"),o=n.pop();delete e(this.collection[0],n)[o]},o.getObject=function(){return this.collection[0]},o.getJSON=function(){return JSON.stringify(this.collection)},o}});