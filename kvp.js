/* key-value-pointer v0.1.0, (c) 2015 Steen Klingberg. License: MIT */
!function(e,t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module?module.exports=t():e.keyValuePointer=t()}(this,function(){function e(e,t){var n,o,r=!1;if("string"==typeof e&&(e=JSON.parse(e)),"object"==typeof e){if("string"==typeof t)n=t.split("/");else{if(!Array.isArray(t))return;n=t}return n.forEach(function(t){r||(t=t.replace("~1","/").replace("~0","~"),""===t?o=e:"undefined"==typeof o[t]?(r=!0,o=void 0):o=o[t])}),o}}return function(t){function n(e,t){var i,c,f,l,u,p=[];for(c=0;c<e.length;c++){l=e[c];for(i in l){u=l._xvq_pointer||"";var s=Object.create(null);if(s.node=l,s.key=i,r[u+"/"+i]=s,f=t.call(o,{key:i,value:l[i],pointer:u+"/"+i}))return"object"==typeof l[i]&&delete l[i]._xvq_pointer,l[i];"object"==typeof l[i]&&(l[i]._xvq_pointer=u+"/"+i,p.push(l[i]))}}return n(p,t)}var o=function(){},r={};return"string"==typeof t&&(t=JSON.parse(t)),"object"==typeof t?o.collection=[t]:console.error(new Error("Only objects are allowed.")),o.query=function(e){return n(this.collection,e)},o.select=function(t){return r[t]?r[t].node[r[t].key]:e(this.collection[0],t)},o.replace=function(t,n){if(r[t])r[t].node[r[t].key]=n;else{var o=t.split("/"),i=o.pop();e(this.collection[0],o)[i]=n}},o.remove=function(t){if(r[t])delete r[t].node[r[t].key];else{var n=t.split("/"),o=n.pop();delete e(this.collection[0],n)[o]}},o}});