/* key-value-pointer v0.2.0, (c) 2015 Steen Klingberg. License: MIT */
!function(e,n){"function"==typeof define&&define.amd?define(n):"undefined"!=typeof module?module.exports=n():e.keyValuePointer=n()}(this,function(){function e(e,n){var t,o,r=!1;if("string"==typeof e&&(e=JSON.parse(e)),"object"==typeof e){if("string"==typeof n)t=n.split("/");else{if(!Array.isArray(n))return;t=n}return t.forEach(function(n){r||(n=n.replace("~1","/").replace("~0","~"),""===n?o=e:"undefined"==typeof o[n]?(r=!0,o=void 0):o=o[n])}),o}}return function(n){function t(e,n,i){var l,c,f,u,p=[];for(c=0;c<e.length;c++){u=e[c];for(l in u){var a=i+"/"+c;if(f=n.call(o,{key:l,value:u[l],pointer:r[a]+"/"+l}))return u[l];"object"==typeof u[l]&&null!==u[l]&&(r[i+1+"/"+p.length]=r[a]+"/"+l,p.push(u[l]))}}return p.length>0?t(p,n,i+1):void 0}var o=function(){},r={"0/0":""};return"string"==typeof n&&(n=JSON.parse(n)),"object"==typeof n&&null!==n?o.collection=[n]:console.error(new Error("Only objects are allowed.")),o.query=function(e){return t(this.collection,e,0)},o.select=function(n){return e(this.collection[0],n)},o.replace=function(n,t){var o=n.split("/"),r=o.pop();e(this.collection[0],o)[r]=t},o.remove=function(n){var t=n.split("/"),o=t.pop();delete e(this.collection[0],t)[o]},o}});