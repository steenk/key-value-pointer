/* key-value-pointer v0.3.1, (c) 2015 Steen Klingberg. License: MIT */
!function(e,t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module?module.exports=t():e.keyValuePointer=t()}(this,function(){function e(e,t){var n,o,i=!1;if("string"==typeof e&&(e=JSON.parse(e)),"object"==typeof e){if("string"==typeof t)n=t.split("/");else{if(!Array.isArray(t))return;n=t}return o=e,n.forEach(function(e){i||(e=e.replace("~1","/").replace("~0","~"),""!==e&&("undefined"==typeof o[e]?(i=!0,o=void 0):o=o[e]))}),o}}return function(t){function n(e,t,r){var c,f,l,u,s=[];for(f=0;f<e.length;f++){u=e[f];for(c in u){var p=r+"/"+f;if(l=t.call(o,{key:c,value:u[c],pointer:i[p]+"/"+c}))return u[c];"object"==typeof u[c]&&null!==u[c]&&(i[r+1+"/"+s.length]=i[p]+"/"+c,s.push(u[c]))}}return s.length>0?n(s,t,r+1):o.collection[0]}var o=function(){},i={"0/0":""};return"string"==typeof t&&(t=JSON.parse(t)),o.collection="object"==typeof t&&null!==t?[t]:[void 0],o.query=function(t,o){if("function"==typeof t)return o=t,n(this.collection,o,0);var r=e(this.collection[0],t);return"object"==typeof r?(i["0/0"]=t,n([r],o,0)):void 0},o.select=function(t){return e(this.collection[0],t)},o.replace=function(t,n){var o=t.split("/"),i=o.pop(),r=e(this.collection[0],o);"object"==typeof r&&(e(this.collection[0],o)[i]=n)},o.remove=function(t){var n=t.split("/"),o=n.pop(),i=e(this.collection[0],n);"object"==typeof i&&i[o]&&delete i[o]},o.insert=o.replace,o.getObject=function(){return this.collection[0]},o.getJSON=function(){return JSON.stringify(this.collection[0])},o.basename=function(e){return e.substr(e.lastIndexOf("/")+1)},o.dirname=function(e){return e.substr(0,e.lastIndexOf("/"))},o}});