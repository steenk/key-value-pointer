/* key-value-pointer v0.1.2, (c) 2015 Steen Klingberg. License: MIT */
!function(e,n){"function"==typeof define&&define.amd?define(n):"undefined"!=typeof module?module.exports=n():e.keyValuePointer=n()}(this,function(){function e(e,n){var t,o,r=!1;if("string"==typeof e&&(e=JSON.parse(e)),"object"==typeof e){if("string"==typeof n)t=n.split("/");else{if(!Array.isArray(n))return;t=n}return t.forEach(function(n){r||(n=n.replace("~1","/").replace("~0","~"),""===n?o=e:"undefined"==typeof o[n]?(r=!0,o=void 0):o=o[n])}),o}}return function(n){function t(e,n){var i,l,c,f,u,p=[];for(l=0;l<e.length;l++){f=e[l];for(i in f){u=f._xvq_pointer||"";var s=Object.create(null);if(s.node=f,s.key=i,r[u+"/"+i]=s,c=n.call(o,{key:i,value:f[i],pointer:u+"/"+i}))return"object"==typeof f[i]&&delete f[i]._xvq_pointer,f[i];"object"==typeof f[i]&&null!==f[i]&&(f[i]._xvq_pointer=u+"/"+i,p.push(f[i]))}}return p.length>0?t(p,n):void 0}var o=function(){},r={};return"string"==typeof n&&(n=JSON.parse(n)),"object"==typeof n&&null!==n?o.collection=[n]:console.error(new Error("Only objects are allowed.")),o.query=function(e){return t(this.collection,e)},o.select=function(n){return r[n]?r[n].node[r[n].key]:e(this.collection[0],n)},o.replace=function(n,t){if(r[n])r[n].node[r[n].key]=t;else{var o=n.split("/"),i=o.pop();e(this.collection[0],o)[i]=t}},o.remove=function(n){if(r[n])delete r[n].node[r[n].key];else{var t=n.split("/"),o=t.pop();delete e(this.collection[0],t)[o]}},o}});